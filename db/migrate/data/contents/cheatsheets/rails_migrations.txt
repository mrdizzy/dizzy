<cheatsheet>
	<title>Rails Migrations</title>
	<section>
		<subhead>Up Methods</subhead>
			<method>
				<minihead>execute</minihead>
				<p>Takes a single string identifying a valid SQL command to execute directly</p>
				<r>  execute "alter table line_items
  add constraint fk_line_item_products
  foreign key (product_id) references products(id)"</r>
  			</method>



<method_odd>
<minihead>create_table</minihead> 
<p>Creates a table on the database. Creates a table called <c>:table_name</c> and makes the table object available to a block that can then add columns to it, following the same format as <c>add_column</c>.The options hash is for fragments like "<c>DEFAULT CHARSET=UTF-8</c>" that are appended to the create table definition.</p>
<r>
  create_table :table_name, ( :primary_key => column_name) ( :id => false ) ( :options =>{options}) do |t|
    t.column :column_name, :column_type, :options
  end
</r>
<p><c>:force => true</c> - forces drop of an existing table of the same name before creation the new one</p>
<p><c>:temporary => true</c> - creates a temporary table, one that goes away when the application disconnects from the database</p> 
<p><c>:options => ""</c> - lets you specify options to your underlying database, will lose default <c>ENGINE=InnoDB</c> statement</p>
</method_odd>



<method>
<minihead>add_column</minihead>
<p>Creates a new column on the specified table.</p>
<r>
  add_column :table_name, :column_name, :column_type
</r>
<p><c>:null => true</c> - forces drop of an existing table of the same name before creating the new one</p>
</method>




<method_odd>
<minihead>add_index</minihead>
<p>Creates an index for the specified table.</p>
<r>
  add_index :table_name, :column_name, :unique => true</r>
</method_odd>




<method>
<minihead>rename_table</minihead>
<p>Renames the specified table.</p>
<r>
  rename_table :new_table_name, :old_table_name
</r>
</method>



<method_odd>
<minihead>rename_column</minihead>
<r>
  rename_table :old_column_name, :new_column_name
</r>
</method_odd>
</section>

<section>
<subhead>Mapping</subhead>

<Table xmlns:aid="http://ns.adobe.com/AdobeInDesign/4.0/" aid:table="table" aid:trows="9" aid:tcols="9">

<Cell aid:table="cell"></Cell><Cell aid:table="cell">db2</Cell><Cell aid:table="cell">mysql</Cell><Cell aid:table="cell">openbase</Cell><Cell aid:table="cell">Oracle</Cell><Cell aid:table="cell">postgresql</Cell><Cell aid:table="cell">sqlite</Cell><Cell aid:table="cell">sqlserver</Cell><Cell aid:table="cell">Sybase</Cell>

<Cell aid:table="cell"><c>:binary</c></Cell><Cell aid:table="cell">blob(32768)</Cell><Cell aid:table="cell">blob</Cell><Cell aid:table="cell">object</Cell><Cell aid:table="cell">blob</Cell><Cell aid:table="cell">bytea</Cell><Cell aid:table="cell">blob</Cell><Cell aid:table="cell">image</Cell><Cell aid:table="cell">image</Cell>

<Cell aid:table="cell"><c>:boolean</c></Cell><Cell aid:table="cell">decimal(1)</Cell><Cell aid:table="cell">tinyint(1)</Cell><Cell aid:table="cell">boolean</Cell><Cell aid:table="cell">number(1)</Cell><Cell aid:table="cell">boolean</Cell><Cell aid:table="cell">boolean</Cell><Cell aid:table="cell">bit</Cell><Cell aid:table="cell">bit</Cell>

<Cell aid:table="cell"><c>:date</c></Cell><Cell aid:table="cell">date</Cell><Cell aid:table="cell">date</Cell><Cell aid:table="cell">date</Cell><Cell aid:table="cell">date</Cell><Cell aid:table="cell">date</Cell><Cell aid:table="cell">date</Cell><Cell aid:table="cell">datetime</Cell><Cell aid:table="cell">datetime</Cell>

<Cell aid:table="cell"><c>:datetime</c></Cell><Cell aid:table="cell">timestamp</Cell><Cell aid:table="cell">datetime</Cell><Cell aid:table="cell">datetime</Cell><Cell aid:table="cell">date</Cell><Cell aid:table="cell">timestamp</Cell><Cell aid:table="cell">datetime</Cell><Cell aid:table="cell">datetime</Cell><Cell aid:table="cell">datetime</Cell>

<Cell aid:table="cell"><c>:decimal</c></Cell><Cell aid:table="cell">decimal</Cell><Cell aid:table="cell">decimal</Cell><Cell aid:table="cell">decimal</Cell><Cell aid:table="cell">decimal</Cell><Cell aid:table="cell">decimal</Cell><Cell aid:table="cell">decimal</Cell><Cell aid:table="cell">decimal</Cell><Cell aid:table="cell">decimal</Cell>

<Cell aid:table="cell"><c>:float</c></Cell><Cell aid:table="cell">float</Cell><Cell aid:table="cell">float</Cell><Cell aid:table="cell">float</Cell><Cell aid:table="cell">number</Cell><Cell aid:table="cell">float</Cell><Cell aid:table="cell">float</Cell><Cell aid:table="cell">float(8)</Cell><Cell aid:table="cell">float(8)</Cell>

<Cell aid:table="cell"><c>:integer</c></Cell><Cell aid:table="cell">int</Cell><Cell aid:table="cell">int(11)</Cell><Cell aid:table="cell">integer</Cell><Cell aid:table="cell">number(38)</Cell><Cell aid:table="cell">integer</Cell><Cell aid:table="cell">integer</Cell><Cell aid:table="cell">int</Cell><Cell aid:table="cell">int</Cell>

<Cell aid:table="cell"><c>:string</c></Cell><Cell aid:table="cell">varchar(255)</Cell><Cell aid:table="cell">varchar(255)</Cell><Cell aid:table="cell">char(4096)</Cell><Cell aid:table="cell">varchar2(255)</Cell><Cell aid:table="cell">*</Cell><Cell aid:table="cell">varchar(255)</Cell><Cell aid:table="cell">varchar(255)</Cell><Cell aid:table="cell">varchar(255)</Cell>


</Table>
</section>
<section>
<subhead>db/migrate/example_001.rb</subhead>
<method>
<r>
class CreateCustomers &lt; ActiveRecord::Migration
  def self.up
    create_table :customers do |t|
      t.column :name,     :string
      t.column :age,      :integer
      t.column :premium,  :boolean
      t.column :photo,    :binary
      t.column :dob,      :date
    end
    SystemSetting.create :name =&gt; "notice", :label =&gt; "Use notice?", :value =&gt; 1
  end
  
  def self.down 
    drop_table :customers
  end
end
</r>
</method>
</section>
<section>
<subhead>rake</subhead>
<method>
<minihead>generate migration</minihead>

<p><c>ruby script/generate migration add_price_column</c></p>
</method>
<method>
<minihead>run all unapplied migrations</minihead>

<p><c>rake db:migrate</c></p>
</method>
<method>
<minihead>migrate database to specific version</minihead>

<p><c>rake db:migrate VERSION=18</c></p>
</method>
</section>
</cheatsheet>
