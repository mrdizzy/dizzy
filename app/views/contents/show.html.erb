<% content_for :breadcrumbs do %> 
   
   <div id="breadcrumbs">
      <p><%= location_icon %> 
         <%= link_to "Home", "/" %> 
   
         <%= solid_arrow %> 
         <%= link_to "Ruby on Rails", latest_path %> 
   
          <%= solid_arrow %> 
         <%= link_to @content.main_category.name, category_path(@content.main_category.permalink) %> 
   
          <%= solid_arrow %>
      </p>
   </div>

<% end %>				
 
<div id="left_column">

   <%= render :partial => "layouts/category_list" %>
	
	<% unless @content.nil? %>
		<% @content.related_articles.each do |related| %>
			<p><%= spiro %></p>
			<div id="blurb">
				<h4><%= solid_arrow %> RELATED ARTICLE</h4>
				<h2><%= asterisk %> <%= related.title %></h2> 
				<p><%= related.description %> <%= solid_arrow %> <%= link_to "More", content_path(related.permalink) %> </p>
			</div>
		<% end %>
	<% end %>
				
</div>
			
<div id="right_column">

   <h1><%= @content.title %></h1>
   <h2><%= @content.description %></h2>

   <%= spiro %>

   <div id="article"><%= @content.parsed_content %></div>

   <%= spiro %>

   <div id="comments">

      <div id="comments_header"><p class="posted_in"> <%= asterisk %> COMMENTS </p></div>
      
      <%= render :partial => "comments/comment", :collection => @content.comments.roots %>
      
      <div id="new_comment_" %>
         <p><%= diamond %> <%= link_to "Add new comment", new_content_comment_path(@content), :id => "new_comment_link" %></p>
      </div>

   </div>

</div>

<% content_for :javascript do %>

   function watchForms(originalRequest) {
      $$('.new_comment').invoke('observe', 'submit', function(e)
         {
         e.stop();
         new Ajax.Request(e.element().action, {parameters: e.element().serialize(), onComplete: watchForms});
         }
      );
   }
 <% end %>
 
 <% content_for :dom_loaded do %>  
 
   $('new_comment_link').observe('click', function(e) {
      e.stop();
            new Ajax.Request('<%= new_content_comment_path(@content) %>', {method:'get', onComplete: watchForms});
      }
   );
   
   $$('.child_comment_link').invoke('observe', 'click', function(e)
      {
         e.stop();
         new Ajax.Request('/ruby_on_rails/contents/<%= @content.id %>/comments/' + e.element().id + '/child_comments/new', {method:'get', onComplete: watchForms});
      }
   );

<% end %>