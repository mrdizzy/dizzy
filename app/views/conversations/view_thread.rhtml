<html>
<head>
<style type="text/css">
.hidden { display: none; }
</style>

<%= javascript_include_tag :defaults %>
</head>
<body>

<!-- VIEWING THREAD -->
<div id="conversation">
	<h1><%= asterisk %> <%= @conversation.parse_code %> "<%= @conversation.subject %>"</h1>
	<p><b>People in this conversation:</b><% @conversation.people.each do |person| %>
    	<%= person.firstname %>, <% end %></p>
<% @conversation.tickets.each do |ticket| %>
	
	<% if ticket.is_a?(IncomingTicket) %>
	<div class="odd" id="ticket_<%= ticket.id %>">
		<h3 class="blue_bold"><%= bigarrow %> Incoming</h3>
		<% else %>
		<div class="normal" id="ticket_<%= ticket.id %>">
			<h3 class="blue_bold"><%= bigleftarrow %> Outgoing</h3>
			<% end %>
			
			<!-- Recipients -->
			<p><b>To:</b> <% ticket.to_recipients.each do |recipient| %>
				<%= recipient.email.person.firstname %>
				<% end %></p>
		
			
		<p><%= ticket.date.to_s(:long) %></p>
	<p><%= ticket.initial_report %></p>
	<% unless ticket.ticket_collaterals.blank? %>
	<b>Attachments:</b>
	<ul>
	<% ticket.ticket_collaterals.each do |collateral| %>
	<li><%= link_to collateral.name, :controller => "render_binary", :action => 'attachment', :id => collateral.id %></li>

	<% end %>
	</ul>
	<% end %>
	<%= diamond %> <%= link_to_remote "Reply", :url => { :controller => :conversations, :action => :reply_form, :id => @conversation.id, :ticket => ticket.id } %>

</div>
<% end %>
</body>
</html>