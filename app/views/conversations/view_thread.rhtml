<html>
<head>
<style type="text/css">
.hidden { display: none; }
</style>

<%= javascript_include_tag :defaults %>
</head>
<body>
<div id="add_reply">
<a href="#" onclick="Element.toggle('reply_box'); Element.remove('add_reply'); return true;">Add reply</a>
<br/></div>
<div id="reply_box" style="display: none;">

<% form_for(:conversation, @conversation, :url =>{:action => :send_reply, :id => @conversation.id }, :html =>{:multipart => true}) do |form| %>
	<% fields_for "ticket", @ticket do |f| %>  
	<p>
	<%= f.text_area :initial_report %>
	</p>  
	<% @ticket.ticket_collaterals.each_with_index do |collateral, index| %> 
	<% fields_for "ticket_collaterals[#{index}]", collateral do |f| %>
	<p><%= f.file_field :data_file %></p>
	<% end %>
<% end %>
	<% end %>
	  	<%= submit_button %>
	<% end %>
</div>
<!-- VIEWING THREAD -->

<div id="conversation">
	<h1><%= asterisk %> <%= @conversation.parse_code %> "<%= @conversation.subject %>"</h1>
<% @conversation.tickets.each do |ticket| %>
	
	<% if ticket.is_a?(IncomingTicket) %>
	<div class="odd">
		-----&gt; Incoming
		<% else %>
		<div>
			&lt;------ Outgoing
			<% end %>
		<p><%= ticket.date.to_s(:long) %></p>
	<p><%= ticket.initial_report %></p>
	<% unless ticket.ticket_collaterals.blank? %>
	<b>Attachments:</b>
	<ul>
	<% ticket.ticket_collaterals.each do |collateral| %>
	<li><%= link_to collateral.name, :controller => "render_binary", :action => 'attachment', :id => collateral.id %></li>

	<% end %>
	</ul>
	<% end %>

</div>
<% end %>
</body>
</html>