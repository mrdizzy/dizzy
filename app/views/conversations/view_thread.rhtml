<html>
<head>
<style type="text/css">
.hidden { display: none; }
</style>

<%= javascript_include_tag :defaults %>
</head>
<body>
<div id="add_reply">
<a href="#" onclick="Element.toggle('reply_box'); Element.remove('add_reply'); return true;">Add reply</a>
<br/></div>
<div id="reply_box" style="display: none;">

<% form_for(:conversation, @conversation, :url =>{:action => :send_reply, :id => @conversation.id }, :html =>{:multipart => true}) do |form| %>
	<% fields_for "ticket", @ticket do |f| %>  
	<p>
	<%= f.text_area :initial_report %>
	</p>  
	<% @ticket.ticket_collaterals.each_with_index do |collateral, index| %> 
	<% fields_for "ticket_collaterals[#{index}]", collateral do |f| %>
	<p><%= f.file_field :data_file %></p>
	<% end %>
<% end %>
	<% end %>
	  	<%= submit_tag "Send" %>
	<% end %>
</div>
<div id="conversation">
<%= @conversation.parse_code %>
<% @conversation.tickets.each do |ticket| %>
	
	<p><b><%= bools %></b></p>
	<p><%= ticket.date.to_s(:long) %></p>
	<p><%= ticket.initial_report %></p>
	<b>Attachments:</b>
	<ul>
	<% ticket.ticket_collaterals.each do |collateral| %>
	<li><%= link_to collateral.name, :controller => "render_binary", :action => 'attachment', :id => collateral.id %></li>
	<% end %>
	</ul>
<hr/>
</div>
<% end %>
</body>
</html>