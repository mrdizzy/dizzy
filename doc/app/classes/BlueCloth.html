<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: BlueCloth</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">BlueCloth</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/lib/bluecloth_rb.html">
                lib/bluecloth.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                String
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
<a href="BlueCloth.html">BlueCloth</a> is a Ruby implementation of
Markdown, a text-to-HTML conversion tool.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000005">apply_block_transforms</a>&nbsp;&nbsp;
      <a href="#M000006">apply_span_transforms</a>&nbsp;&nbsp;
      <a href="#M000003">detab</a>&nbsp;&nbsp;
      <a href="#M000004">detab!</a>&nbsp;&nbsp;
      <a href="#M000011">encode_backslash_escapes</a>&nbsp;&nbsp;
      <a href="#M000025">encode_code</a>&nbsp;&nbsp;
      <a href="#M000018">encode_email_address</a>&nbsp;&nbsp;
      <a href="#M000028">encode_html</a>&nbsp;&nbsp;
      <a href="#M000026">escape_md</a>&nbsp;&nbsp;
      <a href="#M000009">escape_special_chars</a>&nbsp;&nbsp;
      <a href="#M000020">form_paragraphs</a>&nbsp;&nbsp;
      <a href="#M000007">hide_html_blocks</a>&nbsp;&nbsp;
      <a href="#M000001">new</a>&nbsp;&nbsp;
      <a href="#M000029">outdent</a>&nbsp;&nbsp;
      <a href="#M000008">strip_link_definitions</a>&nbsp;&nbsp;
      <a href="#M000002">to_html</a>&nbsp;&nbsp;
      <a href="#M000027">tokenize_html</a>&nbsp;&nbsp;
      <a href="#M000021">transform_anchors</a>&nbsp;&nbsp;
      <a href="#M000017">transform_auto_links</a>&nbsp;&nbsp;
      <a href="#M000016">transform_block_quotes</a>&nbsp;&nbsp;
      <a href="#M000015">transform_code_blocks</a>&nbsp;&nbsp;
      <a href="#M000023">transform_code_spans</a>&nbsp;&nbsp;
      <a href="#M000019">transform_headers</a>&nbsp;&nbsp;
      <a href="#M000012">transform_hrules</a>&nbsp;&nbsp;
      <a href="#M000024">transform_images</a>&nbsp;&nbsp;
      <a href="#M000022">transform_italic_and_bold</a>&nbsp;&nbsp;
      <a href="#M000014">transform_list_items</a>&nbsp;&nbsp;
      <a href="#M000013">transform_lists</a>&nbsp;&nbsp;
      <a href="#M000010">unescape_special_chars</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">

    <div id="class-list">
      <h3 class="section-bar">Classes and Modules</h3>

      Class <a href="BlueCloth/FormatError.html" class="link">BlueCloth::FormatError</a><br />

    </div>

    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Version</td>
          <td>=</td>
          <td class="context-item-value">'0.0.3'</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Release Version

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">SvnRev</td>
          <td>=</td>
          <td class="context-item-value">%q$Rev: 69 $</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
SVN Revision

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">SvnId</td>
          <td>=</td>
          <td class="context-item-value">%q$Id: bluecloth.rb 69 2004-08-25 05:27:15Z ged $</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
SVN Id tag

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">SvnUrl</td>
          <td>=</td>
          <td class="context-item-value">%q$URL: svn+ssh://svn.faeriemud.org/usr/local/svn/BlueCloth/trunk/lib/bluecloth.rb $</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
SVN URL

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">RenderState</td>
          <td>=</td>
          <td class="context-item-value">Struct::new( &quot;RenderState&quot;, :urls, :titles, :html_blocks, :log )</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Rendering state struct. Keeps track of URLs, titles, and HTML blocks midway
through a render. I prefer this to the globals of the Perl version because
globals make me break out in hives. Or something.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">TabWidth</td>
          <td>=</td>
          <td class="context-item-value">4</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Tab width for <a href="BlueCloth.html#M000003">detab</a>! if none is
specified

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">EmptyElementSuffix</td>
          <td>=</td>
          <td class="context-item-value">&quot;/&gt;&quot;;</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
The tag-closing string &#8212; set to &#8217;&gt;&#8217; for HTML

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">EscapeTable</td>
          <td>=</td>
          <td class="context-item-value">{}</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Table of MD5 sums for escaped characters

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">StrictBlockTags</td>
          <td>=</td>
          <td class="context-item-value">%w[ p div h[1-6] blockquote pre table dl ol ul script noscript                 form fieldset iframe math ins del ]</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
The list of tags which are considered block-level constructs and an
alternation pattern suitable for use in regexps made from the list

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">StrictTagPattern</td>
          <td>=</td>
          <td class="context-item-value">StrictBlockTags.join('|')</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">LooseBlockTags</td>
          <td>=</td>
          <td class="context-item-value">StrictBlockTags - %w[ins del]</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">LooseTagPattern</td>
          <td>=</td>
          <td class="context-item-value">LooseBlockTags.join('|')</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">StrictBlockRegex</td>
          <td>=</td>
          <td class="context-item-value">%r{                 ^                                             # Start of line                 &lt;(#{StrictTagPattern})        # Start tag: \2                 \b                                            # word break                 (.*\n)*?                              # Any number of lines, minimal match                 &lt;/\1&gt;                                 # Matching end tag                 [ ]*                                  # trailing spaces                 $                                             # End of line or document           }ix</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Nested blocks:

<pre>
     &lt;div&gt;
             &lt;div&gt;
             tags for inner block must be indented.
             &lt;/div&gt;
     &lt;/div&gt;
</pre>
</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">LooseBlockRegex</td>
          <td>=</td>
          <td class="context-item-value">%r{                 ^                                             # Start of line                 &lt;(#{LooseTagPattern}) # start tag: \2                 \b                                            # word break                 (.*\n)*?                              # Any number of lines, minimal match                 .*&lt;/\1&gt;                                       # Anything + Matching end tag                 [ ]*                                  # trailing spaces                 $                                             # End of line or document           }ix</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
More-liberal block-matching

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">HruleBlockRegex</td>
          <td>=</td>
          <td class="context-item-value">%r{                 (                                             # $1                         \A\n?                                # Start of doc + optional \n                         |                                    # or                         .*\n\n                               # anything + blank line                 )                 (                                             # save in $2                         [ ]*                         # Any spaces                         &lt;hr                                  # Tag open                         \b                                   # Word break                         ([^&lt;&gt;])*?                    # Attributes                         /?&gt;                                  # Tag close                         $                                    # followed by a blank line or end of document                 )           }ix</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Special case for &lt;hr /&gt;.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">LinkRegex</td>
          <td>=</td>
          <td class="context-item-value">%r{                 ^[ ]*\[(.+)\]:                # id = $1                   [ ]*                   \n?                         # maybe *one* newline                   [ ]*                 &lt;?(\S+?)&gt;?                            # url = $2                   [ ]*                   \n?                         # maybe one newline                   [ ]*                 (?:                         # Titles are delimited by &quot;quotes&quot; or (parens).                         [&quot;(]                         (.+?)                        # title = $3                         [&quot;)]                 # Matching ) or &quot;                         [ ]*                 )?    # title is optional                 (?:\n+|\Z)           }x</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Link defs are in the form: ^[id]: url &quot;optional title&quot;

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">ListMarkerOl</td>
          <td>=</td>
          <td class="context-item-value">%r{\d+\.}</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Patterns to match and transform lists

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">ListMarkerUl</td>
          <td>=</td>
          <td class="context-item-value">%r{[*+-]}</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">ListMarkerAny</td>
          <td>=</td>
          <td class="context-item-value">Regexp::union( ListMarkerOl, ListMarkerUl )</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">ListRegexp</td>
          <td>=</td>
          <td class="context-item-value">%r{                   (?:                         ^[ ]{0,#{TabWidth - 1}}              # Indent &lt; tab width                         (#{ListMarkerAny})                   # unordered or ordered ($1)                         [ ]+                                         # At least one space                   )                   (?m:.+?)                                            # item content (include newlines)                   (?:                           \z                                         # Either EOF                         |                                                    #  or                           \n{2,}                                     # Blank line...                           (?=\S)                                     # ...followed by non-space                           (?![ ]*                                    # ...but not another item                                 (#{ListMarkerAny})                            [ ]+)                   )           }x</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">ListItemRegexp</td>
          <td>=</td>
          <td class="context-item-value">%r{                 (\n)?                                                 # leading line = $1                 (^[ ]*)                                                       # leading whitespace = $2                 (#{ListMarkerAny}) [ ]+                       # list marker = $3                 ((?m:.+?)                                             # list item text   = $4                 (\n{1,2}))                 (?= \n* (\z | \2 (#{ListMarkerAny}) [ ]+))           }x</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Pattern for transforming list items

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">CodeBlockRegexp</td>
          <td>=</td>
          <td class="context-item-value">%r{                 (?:\n\n|\A)                 (                                                                     # $1 = the code block                   (?:                         (?:[ ]{#{TabWidth}} | \t)            # a tab or tab-width of spaces                         .*\n+                   )+                 )                 (^[ ]{0,#{TabWidth - 1}}\S|\Z)                # Lookahead for non-space at                                                                                         # line-start, or end of doc           }x</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Pattern for matching codeblocks

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">BlockQuoteRegexp</td>
          <td>=</td>
          <td class="context-item-value">%r{                   (?:                         ^[ ]*&gt;[ ]?           # '&gt;' at the start of a line                           .+\n                       # rest of the first line                         (?:.+\n)*            # subsequent consecutive lines                         \n*                          # blanks                   )+           }x</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Pattern for matching Markdown blockquote blocks

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">PreChunk</td>
          <td>=</td>
          <td class="context-item-value">%r{ ( ^ \s* &lt;pre&gt; .+? &lt;/pre&gt; ) }xm</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">AutoAnchorURLRegexp</td>
          <td>=</td>
          <td class="context-item-value">/&lt;((https?|ftp):[^'&quot;&gt;\s]+)&gt;/</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">AutoAnchorEmailRegexp</td>
          <td>=</td>
          <td class="context-item-value">%r{                 &lt;                 (                         [-.\w]+                         \@                         [-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+                 )                 &gt;           }xi</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Encoders</td>
          <td>=</td>
          <td class="context-item-value">[                 lambda {|char| &quot;&amp;#%03d;&quot; % char},                 lambda {|char| &quot;&amp;#x%X;&quot; % char},                 lambda {|char| char.chr },         ]</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Encoder functions to turn characters of an email address into encoded
entities.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">SetextHeaderRegexp</td>
          <td>=</td>
          <td class="context-item-value">%r{                 (.+)                  # The title text ($1)                 \n                 ([\-=])+              # Match a line of = or -. Save only one in $2.                 [ ]*\n+            }x</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Regex for matching Setext-style headers

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">AtxHeaderRegexp</td>
          <td>=</td>
          <td class="context-item-value">%r{                 ^(\#{1,6})    # $1 = string of #'s                 [ ]*                 (.+?)         # $2 = Header text                 [ ]*                 \#*                   # optional closing #'s (not counted)                 \n+           }x</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Regexp for matching ATX-style headers

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">RefLinkIdRegex</td>
          <td>=</td>
          <td class="context-item-value">%r{                 [ ]?                                  # Optional leading space                 (?:\n[ ]*)?                           # Optional newline + spaces                 \[                         (.*?)                                # Id = $1                 \]           }x</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Pattern to match the linkid part of an anchor tag for reference-style
links.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">InlineLinkRegex</td>
          <td>=</td>
          <td class="context-item-value">%r{                 \(                                            # Literal paren                         [ ]*                         # Zero or more spaces                         &lt;?(.+?)&gt;?                    # URI = $1                         [ ]*                         # Zero or more spaces                         (?:                                  #                                  ([\&quot;\'])            # Opening quote char = $2                                 (.*?)                       # Title = $3                                 \2                          # Matching quote char                         )?                                   # Title is optional                 \)           }x</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">BoldRegexp</td>
          <td>=</td>
          <td class="context-item-value">%r{ (\*\*|__) (\S|\S.+?\S) \1 }x</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Pattern to match strong emphasis in Markdown text

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">ItalicRegexp</td>
          <td>=</td>
          <td class="context-item-value">%r{ (\*|_) (\S|\S.+?\S) \1 }x</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Pattern to match normal emphasis in Markdown text

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">InlineImageRegexp</td>
          <td>=</td>
          <td class="context-item-value">%r{                 (                                     # Whole match = $1                         !\[ (.*?) \] # alt text = $2                   \([ ]*                         &lt;?(\S+?)&gt;?           # source url = $3                     [ ]*                         (?:                          #                            ([&quot;'])             # quote char = $4                           (.*?)                      # title = $5                           \4                 # matching quote                           [ ]*                         )?                           # title is optional                   \)                 )           }xs</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Next, handle inline images: ![alt text](url &quot;optional title&quot;)
Don&#8216;t forget: encode * and _

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">ReferenceImageRegexp</td>
          <td>=</td>
          <td class="context-item-value">%r{                 (                                     # Whole match = $1                         !\[ (.*?) \] # Alt text = $2                         [ ]?                 # Optional space                         (?:\n[ ]*)?          # One optional newline + spaces                         \[ (.*?) \]          # id = $3                 )           }xs</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Reference-style images

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">CodeEscapeRegexp</td>
          <td>=</td>
          <td class="context-item-value">%r{( \* | _ | \{ | \} | \[ | \] | \\ )}x</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Regexp to match special characters in a code block

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">HTMLCommentRegexp</td>
          <td>=</td>
          <td class="context-item-value">%r{ &lt;! ( -- .*? -- \s* )+ &gt; }mx</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Matching constructs for tokenizing X/HTML

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">XMLProcInstRegexp</td>
          <td>=</td>
          <td class="context-item-value">%r{ &lt;\? .*? \?&gt; }mx</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">MetaTag</td>
          <td>=</td>
          <td class="context-item-value">Regexp::union( HTMLCommentRegexp, XMLProcInstRegexp )</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">HTMLTagOpenRegexp</td>
          <td>=</td>
          <td class="context-item-value">%r{ &lt; [a-z/!$] [^&lt;&gt;]* }imx</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">HTMLTagCloseRegexp</td>
          <td>=</td>
          <td class="context-item-value">%r{ &gt; }x</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">HTMLTagPart</td>
          <td>=</td>
          <td class="context-item-value">Regexp::union( HTMLTagOpenRegexp, HTMLTagCloseRegexp )</td>
        </tr>
        </table>
      </div>
    </div>



    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">filter_html</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
Filters for controlling what gets output for untrusted input. (But really,
you&#8216;re filtering bad stuff out of untrusted input at submission-time
via untainting, aren&#8216;t you?)

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">filter_styles</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
Filters for controlling what gets output for untrusted input. (But really,
you&#8216;re filtering bad stuff out of untrusted input at submission-time
via untainting, aren&#8216;t you?)

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">fold_lines</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
RedCloth-compatibility accessor. Line-folding is part of Markdown syntax,
so this isn&#8216;t used by anything.

</td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000001" class="method-detail">
        <a name="M000001"></a>

        <div class="method-heading">
          <a href="#M000001" class="method-signature">
          <span class="method-name">new</span><span class="method-args">( content=&quot;&quot;, *restrictions )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Create a <a href="BlueCloth.html#M000001">new</a> <a
href="BlueCloth.html">BlueCloth</a> string.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000001-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000001-source">
<pre>
     <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 126</span>
126:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>( <span class="ruby-identifier">content</span>=<span class="ruby-value str">&quot;&quot;</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">restrictions</span> )
127:                 <span class="ruby-ivar">@log</span> = <span class="ruby-constant">Logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">new</span>( <span class="ruby-identifier">$deferr</span> )
128:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">level</span> = <span class="ruby-identifier">$DEBUG</span> <span class="ruby-operator">?</span>
129:                         <span class="ruby-constant">Logger</span><span class="ruby-operator">::</span><span class="ruby-constant">DEBUG</span> <span class="ruby-operator">:</span>
130:                         (<span class="ruby-identifier">$VERBOSE</span> <span class="ruby-operator">?</span> <span class="ruby-constant">Logger</span><span class="ruby-operator">::</span><span class="ruby-constant">INFO</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Logger</span><span class="ruby-operator">::</span><span class="ruby-constant">WARN</span>)
131:                 <span class="ruby-ivar">@scanner</span> = <span class="ruby-keyword kw">nil</span>
132: 
133:                 <span class="ruby-comment cmt"># Add any restrictions, and set the line-folding attribute to reflect</span>
134:                 <span class="ruby-comment cmt"># what happens by default.</span>
135:                 <span class="ruby-ivar">@filter_html</span> = <span class="ruby-keyword kw">nil</span>
136:                 <span class="ruby-ivar">@filter_styles</span> = <span class="ruby-keyword kw">nil</span>
137:                 <span class="ruby-identifier">restrictions</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">__send__</span>(<span class="ruby-node">&quot;#{r}=&quot;</span>, <span class="ruby-keyword kw">true</span>) }
138:                 <span class="ruby-ivar">@fold_lines</span> = <span class="ruby-keyword kw">true</span>
139: 
140:                 <span class="ruby-keyword kw">super</span>( <span class="ruby-identifier">content</span> )
141: 
142:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;String is: %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-keyword kw">self</span>
143:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000005" class="method-detail">
        <a name="M000005"></a>

        <div class="method-heading">
          <a href="#M000005" class="method-signature">
          <span class="method-name">apply_block_transforms</span><span class="method-args">( str, rs )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Do block-level transforms on a copy of <tt>str</tt> using the specified
render state <tt>rs</tt> and return the results.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000005-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000005-source">
<pre>
     <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 240</span>
240:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">apply_block_transforms</span>( <span class="ruby-identifier">str</span>, <span class="ruby-identifier">rs</span> )
241:                 <span class="ruby-comment cmt"># Port: This was called '_runBlockGamut' in the original</span>
242: 
243:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Applying block transforms to:\n  %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">str</span>
244:                 <span class="ruby-identifier">text</span> = <span class="ruby-identifier">transform_headers</span>( <span class="ruby-identifier">str</span>, <span class="ruby-identifier">rs</span> )
245:                 <span class="ruby-identifier">text</span> = <span class="ruby-identifier">transform_hrules</span>( <span class="ruby-identifier">text</span>, <span class="ruby-identifier">rs</span> )
246:                 <span class="ruby-identifier">text</span> = <span class="ruby-identifier">transform_lists</span>( <span class="ruby-identifier">text</span>, <span class="ruby-identifier">rs</span> )
247:                 <span class="ruby-identifier">text</span> = <span class="ruby-identifier">transform_code_blocks</span>( <span class="ruby-identifier">text</span>, <span class="ruby-identifier">rs</span> )
248:                 <span class="ruby-identifier">text</span> = <span class="ruby-identifier">transform_block_quotes</span>( <span class="ruby-identifier">text</span>, <span class="ruby-identifier">rs</span> )
249:                 <span class="ruby-identifier">text</span> = <span class="ruby-identifier">transform_auto_links</span>( <span class="ruby-identifier">text</span>, <span class="ruby-identifier">rs</span> )
250:                 <span class="ruby-identifier">text</span> = <span class="ruby-identifier">hide_html_blocks</span>( <span class="ruby-identifier">text</span>, <span class="ruby-identifier">rs</span> )
251: 
252:                 <span class="ruby-identifier">text</span> = <span class="ruby-identifier">form_paragraphs</span>( <span class="ruby-identifier">text</span>, <span class="ruby-identifier">rs</span> )
253: 
254:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Done with block transforms:\n  %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">text</span>
255:                 <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">text</span>
256:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000006" class="method-detail">
        <a name="M000006"></a>

        <div class="method-heading">
          <a href="#M000006" class="method-signature">
          <span class="method-name">apply_span_transforms</span><span class="method-args">( str, rs )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Apply Markdown span transforms to a copy of the specified <tt>str</tt> with
the given render state <tt>rs</tt> and return it.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000006-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000006-source">
<pre>
     <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 261</span>
261:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">apply_span_transforms</span>( <span class="ruby-identifier">str</span>, <span class="ruby-identifier">rs</span> )
262:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Applying span transforms to:\n  %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">str</span>
263: 
264:                 <span class="ruby-identifier">str</span> = <span class="ruby-identifier">transform_code_spans</span>( <span class="ruby-identifier">str</span>, <span class="ruby-identifier">rs</span> )
265:                 <span class="ruby-identifier">str</span> = <span class="ruby-identifier">encode_html</span>( <span class="ruby-identifier">str</span> )
266:                 <span class="ruby-identifier">str</span> = <span class="ruby-identifier">transform_images</span>( <span class="ruby-identifier">str</span>, <span class="ruby-identifier">rs</span> )
267:                 <span class="ruby-identifier">str</span> = <span class="ruby-identifier">transform_anchors</span>( <span class="ruby-identifier">str</span>, <span class="ruby-identifier">rs</span> )
268:                 <span class="ruby-identifier">str</span> = <span class="ruby-identifier">transform_italic_and_bold</span>( <span class="ruby-identifier">str</span>, <span class="ruby-identifier">rs</span> )
269: 
270:                 <span class="ruby-comment cmt"># Hard breaks</span>
271:                 <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub!</span>( <span class="ruby-regexp re">/ {2,}\n/</span>, <span class="ruby-node">&quot;&lt;br#{EmptyElementSuffix}\n&quot;</span> )
272: 
273:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Done with span transforms:\n  %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">str</span>
274:                 <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">str</span>
275:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000003" class="method-detail">
        <a name="M000003"></a>

        <div class="method-heading">
          <a href="#M000003" class="method-signature">
          <span class="method-name">detab</span><span class="method-args">( tabwidth=TabWidth )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Convert tabs in <tt>str</tt> to spaces.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000003-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000003-source">
<pre>
     <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 216</span>
216:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">detab</span>( <span class="ruby-identifier">tabwidth</span>=<span class="ruby-constant">TabWidth</span> )
217:                 <span class="ruby-identifier">copy</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">dup</span>
218:                 <span class="ruby-identifier">copy</span>.<span class="ruby-identifier">detab!</span>( <span class="ruby-identifier">tabwidth</span> )
219:                 <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">copy</span>
220:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000004" class="method-detail">
        <a name="M000004"></a>

        <div class="method-heading">
          <a href="#M000004" class="method-signature">
          <span class="method-name">detab!</span><span class="method-args">( tabwidth=TabWidth )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Convert tabs to spaces in place and return self if any were converted.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000004-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000004-source">
<pre>
     <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 224</span>
224:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">detab!</span>( <span class="ruby-identifier">tabwidth</span>=<span class="ruby-constant">TabWidth</span> )
225:                 <span class="ruby-identifier">newstr</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">split</span>( <span class="ruby-regexp re">/\n/</span> ).<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
226:                         <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub</span>( <span class="ruby-regexp re">/(.*?)\t/</span> ) <span class="ruby-keyword kw">do</span>
227:                                 <span class="ruby-identifier">$1</span> <span class="ruby-operator">+</span> <span class="ruby-value str">' '</span> <span class="ruby-operator">*</span> (<span class="ruby-identifier">tabwidth</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">tabwidth</span>)
228:                         <span class="ruby-keyword kw">end</span>
229:                 }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
230:                 <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">replace</span>( <span class="ruby-identifier">newstr</span> )
231:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000011" class="method-detail">
        <a name="M000011"></a>

        <div class="method-heading">
          <a href="#M000011" class="method-signature">
          <span class="method-name">encode_backslash_escapes</span><span class="method-args">( str )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return a copy of the given <tt>str</tt> with any backslashed special
character in it replaced with MD5 placeholders.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000011-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000011-source">
<pre>
     <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 439</span>
439:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">encode_backslash_escapes</span>( <span class="ruby-identifier">str</span> )
440:                 <span class="ruby-comment cmt"># Make a copy with any double-escaped backslashes encoded</span>
441:                 <span class="ruby-identifier">text</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>( <span class="ruby-regexp re">/\\\\/</span>, <span class="ruby-constant">EscapeTable</span>[<span class="ruby-value str">'\\'</span>][<span class="ruby-identifier">:md5</span>] )
442:                 
443:                 <span class="ruby-constant">EscapeTable</span>.<span class="ruby-identifier">each_pair</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">char</span>, <span class="ruby-identifier">esc</span><span class="ruby-operator">|</span>
444:                         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">char</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'\\'</span>
445:                         <span class="ruby-identifier">text</span>.<span class="ruby-identifier">gsub!</span>( <span class="ruby-identifier">esc</span>[<span class="ruby-identifier">:re</span>], <span class="ruby-identifier">esc</span>[<span class="ruby-identifier">:md5</span>] )
446:                 }
447: 
448:                 <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">text</span>
449:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000025" class="method-detail">
        <a name="M000025"></a>

        <div class="method-heading">
          <a href="#M000025" class="method-signature">
          <span class="method-name">encode_code</span><span class="method-args">( str, rs )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Escape any characters special to HTML and encode any characters special to
Markdown in a copy of the given <tt>str</tt> and return it.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000025-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000025-source">
<pre>
      <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 1027</span>
1027:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">encode_code</span>( <span class="ruby-identifier">str</span>, <span class="ruby-identifier">rs</span> )
1028:                 <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>( <span class="ruby-regexp re">%r{&amp;}</span>, <span class="ruby-value str">'&amp;amp;'</span> ).
1029:                         <span class="ruby-identifier">gsub</span>( <span class="ruby-regexp re">%r{&lt;}</span>, <span class="ruby-value str">'&amp;lt;'</span> ).
1030:                         <span class="ruby-identifier">gsub</span>( <span class="ruby-regexp re">%r{&gt;}</span>, <span class="ruby-value str">'&amp;gt;'</span> ).
1031:                         <span class="ruby-identifier">gsub</span>( <span class="ruby-constant">CodeEscapeRegexp</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">match</span><span class="ruby-operator">|</span> <span class="ruby-constant">EscapeTable</span>[<span class="ruby-identifier">match</span>][<span class="ruby-identifier">:md5</span>]}
1032:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000018" class="method-detail">
        <a name="M000018"></a>

        <div class="method-heading">
          <a href="#M000018" class="method-signature">
          <span class="method-name">encode_email_address</span><span class="method-args">( addr )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Transform a copy of the given email <tt>addr</tt> into an escaped version
safer for posting publicly.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000018-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000018-source">
<pre>
     <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 634</span>
634:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">encode_email_address</span>( <span class="ruby-identifier">addr</span> )
635: 
636:                 <span class="ruby-identifier">rval</span> = <span class="ruby-value str">''</span>
637:                 (<span class="ruby-value str">&quot;mailto:&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">addr</span>).<span class="ruby-identifier">each_byte</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">b</span><span class="ruby-operator">|</span>
638:                         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">b</span>
639:                         <span class="ruby-keyword kw">when</span> <span class="ruby-value">?:</span>
640:                                 <span class="ruby-identifier">rval</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;:&quot;</span>
641:                         <span class="ruby-keyword kw">when</span> <span class="ruby-value">?@</span>
642:                                 <span class="ruby-identifier">rval</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">Encoders</span>[ <span class="ruby-identifier">rand</span>(<span class="ruby-value">2</span>) ][ <span class="ruby-identifier">b</span> ]
643:                         <span class="ruby-keyword kw">else</span>
644:                                 <span class="ruby-identifier">r</span> = <span class="ruby-identifier">rand</span>(<span class="ruby-value">100</span>)
645:                                 <span class="ruby-identifier">rval</span> <span class="ruby-operator">+=</span> (
646:                                         <span class="ruby-identifier">r</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">90</span> <span class="ruby-operator">?</span> <span class="ruby-constant">Encoders</span>[<span class="ruby-value">2</span>][ <span class="ruby-identifier">b</span> ] <span class="ruby-operator">:</span>
647:                                         <span class="ruby-identifier">r</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">45</span> <span class="ruby-operator">?</span> <span class="ruby-constant">Encoders</span>[<span class="ruby-value">1</span>][ <span class="ruby-identifier">b</span> ] <span class="ruby-operator">:</span>
648:                                                          <span class="ruby-constant">Encoders</span>[<span class="ruby-value">0</span>][ <span class="ruby-identifier">b</span> ]
649:                                 )
650:                         <span class="ruby-keyword kw">end</span>
651:                 }
652: 
653:                 <span class="ruby-keyword kw">return</span> <span class="ruby-value str">%{&lt;a href=&quot;%s&quot;&gt;%s&lt;/a&gt;}</span> <span class="ruby-operator">%</span> [ <span class="ruby-identifier">rval</span>, <span class="ruby-identifier">rval</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/.+?:/</span>, <span class="ruby-value str">''</span>) ]
654:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000028" class="method-detail">
        <a name="M000028"></a>

        <div class="method-heading">
          <a href="#M000028" class="method-signature">
          <span class="method-name">encode_html</span><span class="method-args">( str )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return a copy of <tt>str</tt> with angle brackets and ampersands
HTML-encoded.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000028-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000028-source">
<pre>
      <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 1131</span>
1131:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">encode_html</span>( <span class="ruby-identifier">str</span> )
1132:                 <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>( <span class="ruby-regexp re">/&amp;(?!#?[x]?(?:[0-9a-f]+|\w+);)/i</span>, <span class="ruby-value str">&quot;&amp;amp;&quot;</span> ).
1133:                         <span class="ruby-identifier">gsub</span>( <span class="ruby-regexp re">%r{&lt;(?![a-z/?\$!])}i</span>, <span class="ruby-value str">&quot;&amp;lt;&quot;</span> )
1134:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000026" class="method-detail">
        <a name="M000026"></a>

        <div class="method-heading">
          <a href="#M000026" class="method-signature">
          <span class="method-name">escape_md</span><span class="method-args">( str )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Escape any markdown characters in a copy of the given <tt>str</tt> and
return it.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000026-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000026-source">
<pre>
      <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 1042</span>
1042:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">escape_md</span>( <span class="ruby-identifier">str</span> )
1043:                 <span class="ruby-identifier">str</span>.
1044:                         <span class="ruby-identifier">gsub</span>( <span class="ruby-regexp re">/\*/</span>, <span class="ruby-constant">EscapeTable</span>[<span class="ruby-value str">'*'</span>][<span class="ruby-identifier">:md5</span>] ).
1045:                         <span class="ruby-identifier">gsub</span>( <span class="ruby-regexp re">/_/</span>,  <span class="ruby-constant">EscapeTable</span>[<span class="ruby-value str">'_'</span>][<span class="ruby-identifier">:md5</span>] )
1046:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000009" class="method-detail">
        <a name="M000009"></a>

        <div class="method-heading">
          <a href="#M000009" class="method-signature">
          <span class="method-name">escape_special_chars</span><span class="method-args">( str )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Escape special characters in the given <tt>str</tt>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000009-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000009-source">
<pre>
     <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 395</span>
395:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">escape_special_chars</span>( <span class="ruby-identifier">str</span> )
396:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;  Escaping special characters&quot;</span>
397:                 <span class="ruby-identifier">text</span> = <span class="ruby-value str">''</span>
398: 
399:                 <span class="ruby-comment cmt"># The original Markdown source has something called '$tags_to_skip'</span>
400:                 <span class="ruby-comment cmt"># declared here, but it's never used, so I don't define it.</span>
401: 
402:                 <span class="ruby-identifier">tokenize_html</span>( <span class="ruby-identifier">str</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">token</span>, <span class="ruby-identifier">str</span><span class="ruby-operator">|</span>
403:                         <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;   Adding %p token %p&quot;</span> <span class="ruby-operator">%</span> [ <span class="ruby-identifier">token</span>, <span class="ruby-identifier">str</span> ]
404:                         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">token</span>
405: 
406:                         <span class="ruby-comment cmt"># Within tags, encode * and _</span>
407:                         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:tag</span>
408:                                 <span class="ruby-identifier">text</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">str</span>.
409:                                         <span class="ruby-identifier">gsub</span>( <span class="ruby-regexp re">/\*/</span>, <span class="ruby-constant">EscapeTable</span>[<span class="ruby-value str">'*'</span>][<span class="ruby-identifier">:md5</span>] ).
410:                                         <span class="ruby-identifier">gsub</span>( <span class="ruby-regexp re">/_/</span>, <span class="ruby-constant">EscapeTable</span>[<span class="ruby-value str">'_'</span>][<span class="ruby-identifier">:md5</span>] )
411: 
412:                         <span class="ruby-comment cmt"># Encode backslashed stuff in regular text</span>
413:                         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:text</span>
414:                                 <span class="ruby-identifier">text</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">encode_backslash_escapes</span>( <span class="ruby-identifier">str</span> )
415:                         <span class="ruby-keyword kw">else</span>
416:                                 <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-value str">&quot;Unknown token type %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">token</span>
417:                         <span class="ruby-keyword kw">end</span>
418:                 }
419: 
420:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;  Text with escapes is now: %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">text</span>
421:                 <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">text</span>
422:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000020" class="method-detail">
        <a name="M000020"></a>

        <div class="method-heading">
          <a href="#M000020" class="method-signature">
          <span class="method-name">form_paragraphs</span><span class="method-args">( str, rs )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Wrap all remaining paragraph-looking text in a copy of <tt>str</tt> inside
&lt;p&gt; tags and return it.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000020-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000020-source">
<pre>
     <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 716</span>
716:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">form_paragraphs</span>( <span class="ruby-identifier">str</span>, <span class="ruby-identifier">rs</span> )
717:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot; Forming paragraphs&quot;</span>
718:                 <span class="ruby-identifier">grafs</span> = <span class="ruby-identifier">str</span>.
719:                         <span class="ruby-identifier">sub</span>( <span class="ruby-regexp re">/\A\n+/</span>, <span class="ruby-value str">''</span> ).
720:                         <span class="ruby-identifier">sub</span>( <span class="ruby-regexp re">/\n+\z/</span>, <span class="ruby-value str">''</span> ).
721:                         <span class="ruby-identifier">split</span>( <span class="ruby-regexp re">/\n{2,}/</span> )
722: 
723:                 <span class="ruby-identifier">rval</span> = <span class="ruby-identifier">grafs</span>.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">graf</span><span class="ruby-operator">|</span>
724: 
725:                         <span class="ruby-comment cmt"># Unhashify HTML blocks if this is a placeholder</span>
726:                         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rs</span>.<span class="ruby-identifier">html_blocks</span>.<span class="ruby-identifier">key?</span>( <span class="ruby-identifier">graf</span> )
727:                                 <span class="ruby-identifier">rs</span>.<span class="ruby-identifier">html_blocks</span>[ <span class="ruby-identifier">graf</span> ]
728: 
729:                         <span class="ruby-comment cmt"># Otherwise, wrap in &lt;p&gt; tags</span>
730:                         <span class="ruby-keyword kw">else</span>
731:                                 <span class="ruby-identifier">apply_span_transforms</span>(<span class="ruby-identifier">graf</span>, <span class="ruby-identifier">rs</span>).
732:                                         <span class="ruby-identifier">sub</span>( <span class="ruby-regexp re">/^[ ]*/</span>, <span class="ruby-value str">'&lt;p&gt;'</span> ) <span class="ruby-operator">+</span> <span class="ruby-value str">'&lt;/p&gt;'</span>
733:                         <span class="ruby-keyword kw">end</span>
734:                 }.<span class="ruby-identifier">join</span>( <span class="ruby-value str">&quot;\n\n&quot;</span> )
735: 
736:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot; Formed paragraphs: %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">rval</span>
737:                 <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">rval</span>
738:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000007" class="method-detail">
        <a name="M000007"></a>

        <div class="method-heading">
          <a href="#M000007" class="method-signature">
          <span class="method-name">hide_html_blocks</span><span class="method-args">( str, rs )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Replace all blocks of HTML in <tt>str</tt> that start in the left margin
with tokens.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000007-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000007-source">
<pre>
     <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 333</span>
333:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">hide_html_blocks</span>( <span class="ruby-identifier">str</span>, <span class="ruby-identifier">rs</span> )
334:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Hiding HTML blocks in %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">str</span>
335:                 
336:                 <span class="ruby-comment cmt"># Tokenizer proc to pass to gsub</span>
337:                 <span class="ruby-identifier">tokenize</span> = <span class="ruby-identifier">lambda</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">match</span><span class="ruby-operator">|</span>
338:                         <span class="ruby-identifier">key</span> = <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">MD5</span><span class="ruby-operator">::</span><span class="ruby-identifier">hexdigest</span>( <span class="ruby-identifier">match</span> )
339:                         <span class="ruby-identifier">rs</span>.<span class="ruby-identifier">html_blocks</span>[ <span class="ruby-identifier">key</span> ] = <span class="ruby-identifier">match</span>
340:                         <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Replacing %p with %p&quot;</span> <span class="ruby-operator">%</span> [ <span class="ruby-identifier">match</span>, <span class="ruby-identifier">key</span> ]
341:                         <span class="ruby-node">&quot;\n\n#{key}\n\n&quot;</span>
342:                 }
343: 
344:                 <span class="ruby-identifier">rval</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">dup</span>
345: 
346:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Finding blocks with the strict regex...&quot;</span>
347:                 <span class="ruby-identifier">rval</span>.<span class="ruby-identifier">gsub!</span>( <span class="ruby-constant">StrictBlockRegex</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">tokenize</span> )
348: 
349:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Finding blocks with the loose regex...&quot;</span>
350:                 <span class="ruby-identifier">rval</span>.<span class="ruby-identifier">gsub!</span>( <span class="ruby-constant">LooseBlockRegex</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">tokenize</span> )
351: 
352:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Finding hrules...&quot;</span>
353:                 <span class="ruby-identifier">rval</span>.<span class="ruby-identifier">gsub!</span>( <span class="ruby-constant">HruleBlockRegex</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">match</span><span class="ruby-operator">|</span> <span class="ruby-identifier">$1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">tokenize</span>[<span class="ruby-identifier">$2</span>] }
354: 
355:                 <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">rval</span>
356:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000029" class="method-detail">
        <a name="M000029"></a>

        <div class="method-heading">
          <a href="#M000029" class="method-signature">
          <span class="method-name">outdent</span><span class="method-args">( str )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return one level of line-leading tabs or spaces from a copy of <tt>str</tt>
and return it.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000029-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000029-source">
<pre>
      <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 1139</span>
1139:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">outdent</span>( <span class="ruby-identifier">str</span> )
1140:                 <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>( <span class="ruby-node">/^(\t|[ ]{1,#{TabWidth}})/</span>, <span class="ruby-value str">''</span>)
1141:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000008" class="method-detail">
        <a name="M000008"></a>

        <div class="method-heading">
          <a href="#M000008" class="method-signature">
          <span class="method-name">strip_link_definitions</span><span class="method-args">( str, rs )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Strip link definitions from <tt>str</tt>, storing them in the given
RenderState <tt>rs</tt>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000008-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000008-source">
<pre>
     <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 381</span>
381:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">strip_link_definitions</span>( <span class="ruby-identifier">str</span>, <span class="ruby-identifier">rs</span> )
382:                 <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>( <span class="ruby-constant">LinkRegex</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">match</span><span class="ruby-operator">|</span>
383:                         <span class="ruby-identifier">id</span>, <span class="ruby-identifier">url</span>, <span class="ruby-identifier">title</span> = <span class="ruby-identifier">$1</span>, <span class="ruby-identifier">$2</span>, <span class="ruby-identifier">$3</span>
384: 
385:                         <span class="ruby-identifier">rs</span>.<span class="ruby-identifier">urls</span>[ <span class="ruby-identifier">id</span>.<span class="ruby-identifier">downcase</span> ] = <span class="ruby-identifier">encode_html</span>( <span class="ruby-identifier">url</span> )
386:                         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">title</span>.<span class="ruby-identifier">nil?</span>
387:                                 <span class="ruby-identifier">rs</span>.<span class="ruby-identifier">titles</span>[ <span class="ruby-identifier">id</span>.<span class="ruby-identifier">downcase</span> ] = <span class="ruby-identifier">title</span>.<span class="ruby-identifier">gsub</span>( <span class="ruby-regexp re">/&quot;/</span>, <span class="ruby-value str">&quot;&amp;quot;&quot;</span> )
388:                         <span class="ruby-keyword kw">end</span>
389:                         <span class="ruby-value str">&quot;&quot;</span>
390:                 }
391:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000002" class="method-detail">
        <a name="M000002"></a>

        <div class="method-heading">
          <a href="#M000002" class="method-signature">
          <span class="method-name">to_html</span><span class="method-args">( lite=false )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Render Markdown-formatted text in this string object as HTML and return it.
The parameter is for compatibility with RedCloth, and is currently unused,
though that may change in the future.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000002-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000002-source">
<pre>
     <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 163</span>
163:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_html</span>( <span class="ruby-identifier">lite</span>=<span class="ruby-keyword kw">false</span> )
164: 
165:                 <span class="ruby-comment cmt"># Create a StringScanner we can reuse for various lexing tasks</span>
166:                 <span class="ruby-ivar">@scanner</span> = <span class="ruby-constant">StringScanner</span><span class="ruby-operator">::</span><span class="ruby-identifier">new</span>( <span class="ruby-value str">''</span> )
167: 
168:                 <span class="ruby-comment cmt"># Make a structure to carry around stuff that gets placeholdered out of</span>
169:                 <span class="ruby-comment cmt"># the source.</span>
170:                 <span class="ruby-identifier">rs</span> = <span class="ruby-constant">RenderState</span><span class="ruby-operator">::</span><span class="ruby-identifier">new</span>( {}, {}, {} )
171: 
172:                 <span class="ruby-comment cmt"># Make a copy of the string with normalized line endings, tabs turned to</span>
173:                 <span class="ruby-comment cmt"># spaces, and a couple of guaranteed newlines at the end</span>
174:                 <span class="ruby-identifier">text</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">gsub</span>( <span class="ruby-regexp re">/\r\n?/</span>, <span class="ruby-value str">&quot;\n&quot;</span> ).<span class="ruby-identifier">detab</span>
175:                 <span class="ruby-identifier">text</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;\n\n&quot;</span>
176:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Normalized line-endings: %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">text</span>
177: 
178:                 <span class="ruby-comment cmt"># Filter HTML if we're asked to do so</span>
179:                 <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">filter_html</span>
180:                         <span class="ruby-identifier">text</span>.<span class="ruby-identifier">gsub!</span>( <span class="ruby-value str">&quot;&lt;&quot;</span>, <span class="ruby-value str">&quot;&amp;lt;&quot;</span> )
181:                         <span class="ruby-identifier">text</span>.<span class="ruby-identifier">gsub!</span>( <span class="ruby-value str">&quot;&gt;&quot;</span>, <span class="ruby-value str">&quot;&amp;gt;&quot;</span> )
182:                         <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Filtered HTML: %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">text</span>
183:                 <span class="ruby-keyword kw">end</span>
184: 
185:                 <span class="ruby-comment cmt"># Simplify blank lines</span>
186:                 <span class="ruby-identifier">text</span>.<span class="ruby-identifier">gsub!</span>( <span class="ruby-regexp re">/^ +$/</span>, <span class="ruby-value str">''</span> )
187:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Tabs -&gt; spaces/blank lines stripped: %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">text</span>
188: 
189:                 <span class="ruby-comment cmt"># Replace HTML blocks with placeholders</span>
190:                 <span class="ruby-identifier">text</span> = <span class="ruby-identifier">hide_html_blocks</span>( <span class="ruby-identifier">text</span>, <span class="ruby-identifier">rs</span> )
191:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Hid HTML blocks: %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">text</span>
192:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Render state: %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">rs</span>
193: 
194:                 <span class="ruby-comment cmt"># Strip link definitions, store in render state</span>
195:                 <span class="ruby-identifier">text</span> = <span class="ruby-identifier">strip_link_definitions</span>( <span class="ruby-identifier">text</span>, <span class="ruby-identifier">rs</span> )
196:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Stripped link definitions: %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">text</span>
197:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Render state: %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">rs</span>
198: 
199:                 <span class="ruby-comment cmt"># Escape meta-characters</span>
200:                 <span class="ruby-identifier">text</span> = <span class="ruby-identifier">escape_special_chars</span>( <span class="ruby-identifier">text</span> )
201:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Escaped special characters: %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">text</span>
202: 
203:                 <span class="ruby-comment cmt"># Transform block-level constructs</span>
204:                 <span class="ruby-identifier">text</span> = <span class="ruby-identifier">apply_block_transforms</span>( <span class="ruby-identifier">text</span>, <span class="ruby-identifier">rs</span> )
205:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;After block-level transforms: %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">text</span>
206: 
207:                 <span class="ruby-comment cmt"># Now swap back in all the escaped characters</span>
208:                 <span class="ruby-identifier">text</span> = <span class="ruby-identifier">unescape_special_chars</span>( <span class="ruby-identifier">text</span> )
209:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;After unescaping special characters: %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">text</span>
210: 
211:                 <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">text</span>
212:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000027" class="method-detail">
        <a name="M000027"></a>

        <div class="method-heading">
          <a href="#M000027" class="method-signature">
          <span class="method-name">tokenize_html</span><span class="method-args">( str ) {|type, token| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Break the HTML source in <tt>str</tt> into a series of tokens and return
them. The tokens are just 2-element Array tuples with a type and the actual
content. If this function is called with a block, the type and text parts
of each token will be yielded to it one at a time as they are extracted.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000027-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000027-source">
<pre>
      <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 1063</span>
1063:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">tokenize_html</span>( <span class="ruby-identifier">str</span> )
1064:                 <span class="ruby-identifier">depth</span> = <span class="ruby-value">0</span>
1065:                 <span class="ruby-identifier">tokens</span> = []
1066:                 <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">string</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">dup</span>
1067:                 <span class="ruby-identifier">type</span>, <span class="ruby-identifier">token</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">nil</span>
1068: 
1069:                 <span class="ruby-keyword kw">until</span> <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">empty?</span>
1070:                         <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Scanning from %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">rest</span>
1071: 
1072:                         <span class="ruby-comment cmt"># Match comments and PIs without nesting</span>
1073:                         <span class="ruby-keyword kw">if</span> (( <span class="ruby-identifier">token</span> = <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">MetaTag</span>) ))
1074:                                 <span class="ruby-identifier">type</span> = <span class="ruby-identifier">:tag</span>
1075: 
1076:                         <span class="ruby-comment cmt"># Do nested matching for HTML tags</span>
1077:                         <span class="ruby-keyword kw">elsif</span> (( <span class="ruby-identifier">token</span> = <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">HTMLTagOpenRegexp</span>) ))
1078:                                 <span class="ruby-identifier">tagstart</span> = <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">pos</span>
1079:                                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot; Found the start of a plain tag at %d&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">tagstart</span>
1080: 
1081:                                 <span class="ruby-comment cmt"># Start the token with the opening angle</span>
1082:                                 <span class="ruby-identifier">depth</span> = <span class="ruby-value">1</span>
1083:                                 <span class="ruby-identifier">type</span> = <span class="ruby-identifier">:tag</span>
1084: 
1085:                                 <span class="ruby-comment cmt"># Scan the rest of the tag, allowing unlimited nested &lt;&gt;s. If</span>
1086:                                 <span class="ruby-comment cmt"># the scanner runs out of text before the tag is closed, raise</span>
1087:                                 <span class="ruby-comment cmt"># an error.</span>
1088:                                 <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">depth</span>.<span class="ruby-identifier">nonzero?</span>
1089: 
1090:                                         <span class="ruby-comment cmt"># Scan either an opener or a closer</span>
1091:                                         <span class="ruby-identifier">chunk</span> = <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">scan</span>( <span class="ruby-constant">HTMLTagPart</span> ) <span class="ruby-keyword kw">or</span>
1092:                                                 <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Malformed tag at character %d: %p&quot;</span> <span class="ruby-operator">%</span> 
1093:                                                         [ <span class="ruby-identifier">tagstart</span>, <span class="ruby-identifier">token</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">rest</span> ]
1094:                                                 
1095:                                         <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;  Found another part of the tag at depth %d: %p&quot;</span> <span class="ruby-operator">%</span> [ <span class="ruby-identifier">depth</span>, <span class="ruby-identifier">chunk</span> ]
1096: 
1097:                                         <span class="ruby-identifier">token</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">chunk</span>
1098: 
1099:                                         <span class="ruby-comment cmt"># If the last character of the token so far is a closing</span>
1100:                                         <span class="ruby-comment cmt"># angle bracket, decrement the depth. Otherwise increment</span>
1101:                                         <span class="ruby-comment cmt"># it for a nested tag.</span>
1102:                                         <span class="ruby-identifier">depth</span> <span class="ruby-operator">+=</span> ( <span class="ruby-identifier">token</span>[<span class="ruby-value">-1</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">'&gt;'</span> <span class="ruby-operator">?</span> <span class="ruby-value">-1</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span> )
1103:                                         <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;  Depth is now #{depth}&quot;</span>
1104:                                 <span class="ruby-keyword kw">end</span>
1105: 
1106:                         <span class="ruby-comment cmt"># Match text segments</span>
1107:                         <span class="ruby-keyword kw">else</span>
1108:                                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot; Looking for a chunk of text&quot;</span>
1109:                                 <span class="ruby-identifier">type</span> = <span class="ruby-identifier">:text</span>
1110: 
1111:                                 <span class="ruby-comment cmt"># Scan forward, always matching at least one character to move</span>
1112:                                 <span class="ruby-comment cmt"># the pointer beyond any non-tag '&lt;'.</span>
1113:                                 <span class="ruby-identifier">token</span> = <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">scan_until</span>( <span class="ruby-regexp re">/[^&lt;]+/</span><span class="ruby-identifier">m</span> )
1114:                         <span class="ruby-keyword kw">end</span>
1115: 
1116:                         <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot; type: %p, token: %p&quot;</span> <span class="ruby-operator">%</span> [ <span class="ruby-identifier">type</span>, <span class="ruby-identifier">token</span> ]
1117: 
1118:                         <span class="ruby-comment cmt"># If a block is given, feed it one token at a time. Add the token to</span>
1119:                         <span class="ruby-comment cmt"># the token list to be returned regardless.</span>
1120:                         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
1121:                                 <span class="ruby-keyword kw">yield</span>( <span class="ruby-identifier">type</span>, <span class="ruby-identifier">token</span> )
1122:                         <span class="ruby-keyword kw">end</span>
1123:                         <span class="ruby-identifier">tokens</span> <span class="ruby-operator">&lt;&lt;</span> [ <span class="ruby-identifier">type</span>, <span class="ruby-identifier">token</span> ]
1124:                 <span class="ruby-keyword kw">end</span>
1125: 
1126:                 <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">tokens</span>
1127:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000021" class="method-detail">
        <a name="M000021"></a>

        <div class="method-heading">
          <a href="#M000021" class="method-signature">
          <span class="method-name">transform_anchors</span><span class="method-args">( str, rs )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Apply Markdown anchor transforms to a copy of the specified <tt>str</tt>
with the given render state <tt>rs</tt> and return it.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000021-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000021-source">
<pre>
     <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 766</span>
766:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">transform_anchors</span>( <span class="ruby-identifier">str</span>, <span class="ruby-identifier">rs</span> )
767:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot; Transforming anchors&quot;</span>
768:                 <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">string</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">dup</span>
769:                 <span class="ruby-identifier">text</span> = <span class="ruby-value str">''</span>
770: 
771:                 <span class="ruby-comment cmt"># Scan the whole string</span>
772:                 <span class="ruby-keyword kw">until</span> <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">empty?</span>
773:                 
774:                         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/\[/</span> )
775:                                 <span class="ruby-identifier">link</span> = <span class="ruby-value str">''</span>; <span class="ruby-identifier">linkid</span> = <span class="ruby-value str">''</span>
776:                                 <span class="ruby-identifier">depth</span> = <span class="ruby-value">1</span>
777:                                 <span class="ruby-identifier">startpos</span> = <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">pos</span>
778:                                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot; Found a bracket-open at %d&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">startpos</span>
779: 
780:                                 <span class="ruby-comment cmt"># Scan the rest of the tag, allowing unlimited nested []s. If</span>
781:                                 <span class="ruby-comment cmt"># the scanner runs out of text before the opening bracket is</span>
782:                                 <span class="ruby-comment cmt"># closed, append the text and return (wasn't a valid anchor).</span>
783:                                 <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">depth</span>.<span class="ruby-identifier">nonzero?</span>
784:                                         <span class="ruby-identifier">linktext</span> = <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">scan_until</span>( <span class="ruby-regexp re">/\]|\[/</span> )
785: 
786:                                         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">linktext</span>
787:                                                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;  Found a bracket at depth %d: %p&quot;</span> <span class="ruby-operator">%</span> [ <span class="ruby-identifier">depth</span>, <span class="ruby-identifier">linktext</span> ]
788:                                                 <span class="ruby-identifier">link</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">linktext</span>
789: 
790:                                                 <span class="ruby-comment cmt"># Decrement depth for each closing bracket</span>
791:                                                 <span class="ruby-identifier">depth</span> <span class="ruby-operator">+=</span> ( <span class="ruby-identifier">linktext</span>[<span class="ruby-value">-1</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">']'</span> <span class="ruby-operator">?</span> <span class="ruby-value">-1</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span> )
792:                                                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;  Depth is now #{depth}&quot;</span>
793: 
794:                                         <span class="ruby-comment cmt"># If there's no more brackets, it must not be an anchor, so</span>
795:                                         <span class="ruby-comment cmt"># just abort.</span>
796:                                         <span class="ruby-keyword kw">else</span>
797:                                                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;  Missing closing brace, assuming non-link.&quot;</span>
798:                                                 <span class="ruby-identifier">link</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">rest</span>
799:                                                 <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">terminate</span>
800:                                                 <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">text</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'['</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">link</span>
801:                                         <span class="ruby-keyword kw">end</span>
802:                                 <span class="ruby-keyword kw">end</span>
803:                                 <span class="ruby-identifier">link</span>.<span class="ruby-identifier">slice!</span>( <span class="ruby-value">-1</span> ) <span class="ruby-comment cmt"># Trim final ']'</span>
804:                                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot; Found leading link %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">link</span>
805: 
806:                                 <span class="ruby-comment cmt"># Look for a reference-style second part</span>
807:                                 <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">scan</span>( <span class="ruby-constant">RefLinkIdRegex</span> )
808:                                         <span class="ruby-identifier">linkid</span> = <span class="ruby-ivar">@scanner</span>[<span class="ruby-value">1</span>]
809:                                         <span class="ruby-identifier">linkid</span> = <span class="ruby-identifier">link</span>.<span class="ruby-identifier">dup</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">linkid</span>.<span class="ruby-identifier">empty?</span>
810:                                         <span class="ruby-identifier">linkid</span>.<span class="ruby-identifier">downcase!</span>
811:                                         <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;  Found a linkid: %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">linkid</span>
812: 
813:                                         <span class="ruby-comment cmt"># If there's a matching link in the link table, build an</span>
814:                                         <span class="ruby-comment cmt"># anchor tag for it.</span>
815:                                         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rs</span>.<span class="ruby-identifier">urls</span>.<span class="ruby-identifier">key?</span>( <span class="ruby-identifier">linkid</span> )
816:                                                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;   Found link key in the link table: %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">rs</span>.<span class="ruby-identifier">urls</span>[<span class="ruby-identifier">linkid</span>]
817:                                                 <span class="ruby-identifier">url</span> = <span class="ruby-identifier">escape_md</span>( <span class="ruby-identifier">rs</span>.<span class="ruby-identifier">urls</span>[<span class="ruby-identifier">linkid</span>] )
818: 
819:                                                 <span class="ruby-identifier">text</span> <span class="ruby-operator">+=</span> <span class="ruby-node">%{&lt;a href=&quot;#{url}&quot;}</span>
820:                                                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rs</span>.<span class="ruby-identifier">titles</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">linkid</span>)
821:                                                         <span class="ruby-identifier">text</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">%{ title=&quot;%s&quot;}</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">escape_md</span>( <span class="ruby-identifier">rs</span>.<span class="ruby-identifier">titles</span>[<span class="ruby-identifier">linkid</span>] )
822:                                                 <span class="ruby-keyword kw">end</span>
823:                                                 <span class="ruby-identifier">text</span> <span class="ruby-operator">+=</span> <span class="ruby-node">%{&gt;#{link}&lt;/a&gt;}</span>
824: 
825:                                         <span class="ruby-comment cmt"># If the link referred to doesn't exist, just append the raw</span>
826:                                         <span class="ruby-comment cmt"># source to the result</span>
827:                                         <span class="ruby-keyword kw">else</span>
828:                                                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;  Linkid %p not found in link table&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">linkid</span>
829:                                                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;  Appending original string instead: &quot;</span>
830:                                                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;%p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">string</span>[ <span class="ruby-identifier">startpos</span><span class="ruby-operator">-</span><span class="ruby-value">1</span> <span class="ruby-operator">..</span> <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">pos</span><span class="ruby-operator">-</span><span class="ruby-value">1</span> ]
831:                                                 <span class="ruby-identifier">text</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">string</span>[ <span class="ruby-identifier">startpos</span><span class="ruby-operator">-</span><span class="ruby-value">1</span> <span class="ruby-operator">..</span> <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">pos</span><span class="ruby-operator">-</span><span class="ruby-value">1</span> ]
832:                                         <span class="ruby-keyword kw">end</span>
833: 
834:                                 <span class="ruby-comment cmt"># ...or for an inline style second part</span>
835:                                 <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">scan</span>( <span class="ruby-constant">InlineLinkRegex</span> )
836:                                         <span class="ruby-identifier">url</span> = <span class="ruby-ivar">@scanner</span>[<span class="ruby-value">1</span>]
837:                                         <span class="ruby-identifier">title</span> = <span class="ruby-ivar">@scanner</span>[<span class="ruby-value">3</span>]
838:                                         <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;  Found an inline link to %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">url</span>
839: 
840:                                         <span class="ruby-identifier">text</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">%{&lt;a href=&quot;%s&quot;}</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">escape_md</span>( <span class="ruby-identifier">url</span> )
841:                                         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">title</span>
842:                                                 <span class="ruby-identifier">title</span>.<span class="ruby-identifier">gsub!</span>( <span class="ruby-regexp re">/&quot;/</span>, <span class="ruby-value str">&quot;&amp;quot;&quot;</span> )
843:                                                 <span class="ruby-identifier">text</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">%{ title=&quot;%s&quot;}</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">escape_md</span>( <span class="ruby-identifier">title</span> )
844:                                         <span class="ruby-keyword kw">end</span>
845:                                         <span class="ruby-identifier">text</span> <span class="ruby-operator">+=</span> <span class="ruby-node">%{&gt;#{link}&lt;/a&gt;}</span>
846: 
847:                                 <span class="ruby-comment cmt"># No linkid part: just append the first part as-is.</span>
848:                                 <span class="ruby-keyword kw">else</span>
849:                                         <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;No linkid, so no anchor. Appending literal text.&quot;</span>
850:                                         <span class="ruby-identifier">text</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">string</span>[ <span class="ruby-identifier">startpos</span><span class="ruby-operator">-</span><span class="ruby-value">1</span> <span class="ruby-operator">..</span> <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">pos</span><span class="ruby-operator">-</span><span class="ruby-value">1</span> ]
851:                                 <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># if linkid</span>
852: 
853:                         <span class="ruby-comment cmt"># Plain text</span>
854:                         <span class="ruby-keyword kw">else</span>
855:                                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot; Scanning to the next link from %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">rest</span>
856:                                 <span class="ruby-identifier">text</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/[^\[]+/</span> )
857:                         <span class="ruby-keyword kw">end</span>
858: 
859:                 <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># until @scanner.empty?</span>
860: 
861:                 <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">text</span>
862:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000017" class="method-detail">
        <a name="M000017"></a>

        <div class="method-heading">
          <a href="#M000017" class="method-signature">
          <span class="method-name">transform_auto_links</span><span class="method-args">( str, rs )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Transform URLs in a copy of the specified <tt>str</tt> into links and
return it.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000017-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000017-source">
<pre>
     <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 615</span>
615:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">transform_auto_links</span>( <span class="ruby-identifier">str</span>, <span class="ruby-identifier">rs</span> )
616:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot; Transforming auto-links&quot;</span>
617:                 <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>( <span class="ruby-constant">AutoAnchorURLRegexp</span>, <span class="ruby-value str">%{&lt;a href=&quot;\\1&quot;&gt;\\1&lt;/a&gt;}</span>).
618:                         <span class="ruby-identifier">gsub</span>( <span class="ruby-constant">AutoAnchorEmailRegexp</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">addr</span><span class="ruby-operator">|</span>
619:                         <span class="ruby-identifier">encode_email_address</span>( <span class="ruby-identifier">unescape_special_chars</span>(<span class="ruby-identifier">$1</span>) )
620:                 }
621:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000016" class="method-detail">
        <a name="M000016"></a>

        <div class="method-heading">
          <a href="#M000016" class="method-signature">
          <span class="method-name">transform_block_quotes</span><span class="method-args">( str, rs )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Transform Markdown-style blockquotes in a copy of the specified
<tt>str</tt> and return it.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000016-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000016-source">
<pre>
     <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 582</span>
582:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">transform_block_quotes</span>( <span class="ruby-identifier">str</span>, <span class="ruby-identifier">rs</span> )
583:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot; Transforming block quotes&quot;</span>
584: 
585:                 <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>( <span class="ruby-constant">BlockQuoteRegexp</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">quote</span><span class="ruby-operator">|</span>
586:                         <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Making blockquote from %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">quote</span>
587: 
588:                         <span class="ruby-identifier">quote</span>.<span class="ruby-identifier">gsub!</span>( <span class="ruby-regexp re">/^ *&gt; ?/</span>, <span class="ruby-value str">''</span> ) <span class="ruby-comment cmt"># Trim one level of quoting </span>
589:                         <span class="ruby-identifier">quote</span>.<span class="ruby-identifier">gsub!</span>( <span class="ruby-regexp re">/^ +$/</span>, <span class="ruby-value str">''</span> )    <span class="ruby-comment cmt"># Trim whitespace-only lines</span>
590: 
591:                         <span class="ruby-identifier">indent</span> = <span class="ruby-value str">&quot; &quot;</span> <span class="ruby-operator">*</span> <span class="ruby-constant">TabWidth</span>
592:                         <span class="ruby-identifier">quoted</span> = <span class="ruby-value str">%{&lt;blockquote&gt;\n%s\n&lt;/blockquote&gt;\n\n}</span> <span class="ruby-operator">%</span>
593:                                 <span class="ruby-identifier">apply_block_transforms</span>( <span class="ruby-identifier">quote</span>, <span class="ruby-identifier">rs</span> ).
594:                                 <span class="ruby-identifier">gsub</span>( <span class="ruby-regexp re">/^/</span>, <span class="ruby-identifier">indent</span> ).
595:                                 <span class="ruby-identifier">gsub</span>( <span class="ruby-constant">PreChunk</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-node">/^#{indent}/o</span>, <span class="ruby-value str">''</span>) }
596:                         <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Blockquoted chunk is: %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">quoted</span>
597:                         <span class="ruby-identifier">quoted</span>
598:                 }
599:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000015" class="method-detail">
        <a name="M000015"></a>

        <div class="method-heading">
          <a href="#M000015" class="method-signature">
          <span class="method-name">transform_code_blocks</span><span class="method-args">( str, rs )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Transform Markdown-style codeblocks in a copy of the specified <tt>str</tt>
and return it.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000015-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000015-source">
<pre>
     <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 555</span>
555:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">transform_code_blocks</span>( <span class="ruby-identifier">str</span>, <span class="ruby-identifier">rs</span> )
556:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot; Transforming code blocks&quot;</span>
557: 
558:                 <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>( <span class="ruby-constant">CodeBlockRegexp</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">block</span><span class="ruby-operator">|</span>
559:                         <span class="ruby-identifier">codeblock</span> = <span class="ruby-identifier">$1</span>
560:                         <span class="ruby-identifier">remainder</span> = <span class="ruby-identifier">$2</span>
561: 
562:                         <span class="ruby-comment cmt"># Generate the codeblock</span>
563:                         <span class="ruby-value str">%{\n\n&lt;pre&gt;&lt;code&gt;%s\n&lt;/code&gt;&lt;/pre&gt;\n\n%s}</span> <span class="ruby-operator">%</span>
564:                                 [ <span class="ruby-identifier">encode_code</span>( <span class="ruby-identifier">outdent</span>(<span class="ruby-identifier">codeblock</span>), <span class="ruby-identifier">rs</span> ).<span class="ruby-identifier">rstrip</span>, <span class="ruby-identifier">remainder</span> ]
565:                 }
566:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000023" class="method-detail">
        <a name="M000023"></a>

        <div class="method-heading">
          <a href="#M000023" class="method-signature">
          <span class="method-name">transform_code_spans</span><span class="method-args">( str, rs )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Transform backticked spans into &lt;code&gt; spans.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000023-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000023-source">
<pre>
     <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 883</span>
883:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">transform_code_spans</span>( <span class="ruby-identifier">str</span>, <span class="ruby-identifier">rs</span> )
884:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot; Transforming code spans&quot;</span>
885: 
886:                 <span class="ruby-comment cmt"># Set up the string scanner and just return the string unless there's at</span>
887:                 <span class="ruby-comment cmt"># least one backtick.</span>
888:                 <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">string</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">dup</span>
889:                 <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">exist?</span>( <span class="ruby-regexp re">/`/</span> )
890:                         <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">terminate</span>
891:                         <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;No backticks found for code span in %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">str</span>
892:                         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">str</span>
893:                 <span class="ruby-keyword kw">end</span>
894: 
895:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Transforming code spans in %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">str</span>
896: 
897:                 <span class="ruby-comment cmt"># Build the transformed text anew</span>
898:                 <span class="ruby-identifier">text</span> = <span class="ruby-value str">''</span>
899: 
900:                 <span class="ruby-comment cmt"># Scan to the end of the string</span>
901:                 <span class="ruby-keyword kw">until</span> <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">empty?</span>
902: 
903:                         <span class="ruby-comment cmt"># Scan up to an opening backtick</span>
904:                         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pre</span> = <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">scan_until</span>( <span class="ruby-regexp re">/.?(?=`)/</span><span class="ruby-identifier">m</span> )
905:                                 <span class="ruby-identifier">text</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">pre</span>
906:                                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Found backtick at %d after '...%s'&quot;</span> <span class="ruby-operator">%</span> [ <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">pos</span>, <span class="ruby-identifier">text</span>[<span class="ruby-value">-10</span>, <span class="ruby-value">10</span>] ]
907: 
908:                                 <span class="ruby-comment cmt"># Make a pattern to find the end of the span</span>
909:                                 <span class="ruby-identifier">opener</span> = <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/`+/</span> )
910:                                 <span class="ruby-identifier">len</span> = <span class="ruby-identifier">opener</span>.<span class="ruby-identifier">length</span>
911:                                 <span class="ruby-identifier">closer</span> = <span class="ruby-constant">Regexp</span><span class="ruby-operator">::</span><span class="ruby-identifier">new</span>( <span class="ruby-identifier">opener</span> )
912:                                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Scanning for end of code span with %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">closer</span>
913: 
914:                                 <span class="ruby-comment cmt"># Scan until the end of the closing backtick sequence. Chop the</span>
915:                                 <span class="ruby-comment cmt"># backticks off the resultant string, strip leading and trailing</span>
916:                                 <span class="ruby-comment cmt"># whitespace, and encode any enitites contained in it.</span>
917:                                 <span class="ruby-identifier">codespan</span> = <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">scan_until</span>( <span class="ruby-identifier">closer</span> ) <span class="ruby-keyword kw">or</span>
918:                                         <span class="ruby-identifier">raise</span> <span class="ruby-constant">FormatError</span><span class="ruby-operator">::</span><span class="ruby-identifier">new</span>( <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">rest</span>[<span class="ruby-value">0</span>,<span class="ruby-value">20</span>],
919:                                                 <span class="ruby-value str">&quot;No %p found before end&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">opener</span> )
920: 
921:                                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Found close of code span at %d: %p&quot;</span> <span class="ruby-operator">%</span> [ <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">len</span>, <span class="ruby-identifier">codespan</span> ]
922:                                 <span class="ruby-identifier">codespan</span>.<span class="ruby-identifier">slice!</span>( <span class="ruby-operator">-</span><span class="ruby-identifier">len</span>, <span class="ruby-identifier">len</span> )
923:                                 <span class="ruby-identifier">text</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;&lt;code&gt;%s&lt;/code&gt;&quot;</span> <span class="ruby-operator">%</span>
924:                                         <span class="ruby-identifier">encode_code</span>( <span class="ruby-identifier">codespan</span>.<span class="ruby-identifier">strip</span>, <span class="ruby-identifier">rs</span> )
925: 
926:                         <span class="ruby-comment cmt"># If there's no more backticks, just append the rest of the string</span>
927:                         <span class="ruby-comment cmt"># and move the scan pointer to the end</span>
928:                         <span class="ruby-keyword kw">else</span>
929:                                 <span class="ruby-identifier">text</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">rest</span>
930:                                 <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">terminate</span>
931:                         <span class="ruby-keyword kw">end</span>
932:                 <span class="ruby-keyword kw">end</span>
933: 
934:                 <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">text</span>
935:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000019" class="method-detail">
        <a name="M000019"></a>

        <div class="method-heading">
          <a href="#M000019" class="method-signature">
          <span class="method-name">transform_headers</span><span class="method-args">( str, rs )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Apply Markdown header transforms to a copy of the given <tt>str</tt> amd
render state <tt>rs</tt> and return the result.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000019-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000019-source">
<pre>
     <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 677</span>
677:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">transform_headers</span>( <span class="ruby-identifier">str</span>, <span class="ruby-identifier">rs</span> )
678:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot; Transforming headers&quot;</span>
679: 
680:                 <span class="ruby-comment cmt"># Setext-style headers:</span>
681:                 <span class="ruby-comment cmt">#       Header 1</span>
682:                 <span class="ruby-comment cmt">#       ========</span>
683:                 <span class="ruby-comment cmt">#  </span>
684:                 <span class="ruby-comment cmt">#       Header 2</span>
685:                 <span class="ruby-comment cmt">#       --------</span>
686:                 <span class="ruby-comment cmt">#</span>
687:                 <span class="ruby-identifier">str</span>.
688:                         <span class="ruby-identifier">gsub</span>( <span class="ruby-constant">SetextHeaderRegexp</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
689:                                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Found setext-style header&quot;</span>
690:                                 <span class="ruby-identifier">title</span>, <span class="ruby-identifier">hdrchar</span> = <span class="ruby-identifier">$1</span>, <span class="ruby-identifier">$2</span>
691:                                 <span class="ruby-identifier">title</span> = <span class="ruby-identifier">apply_span_transforms</span>( <span class="ruby-identifier">title</span>, <span class="ruby-identifier">rs</span> )
692: 
693:                                 <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">hdrchar</span>
694:                                 <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'='</span>
695:                                         <span class="ruby-node">%[&lt;h1&gt;#{title}&lt;/h1&gt;\n\n]</span>
696:                                 <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'-'</span>
697:                                         <span class="ruby-node">%[&lt;h2&gt;#{title}&lt;/h2&gt;\n\n]</span>
698:                                 <span class="ruby-keyword kw">else</span>
699:                                         <span class="ruby-identifier">title</span>
700:                                 <span class="ruby-keyword kw">end</span>
701:                         }.
702: 
703:                         <span class="ruby-identifier">gsub</span>( <span class="ruby-constant">AtxHeaderRegexp</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
704:                                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Found ATX-style header&quot;</span>
705:                                 <span class="ruby-identifier">hdrchars</span>, <span class="ruby-identifier">title</span> = <span class="ruby-identifier">$1</span>, <span class="ruby-identifier">$2</span>
706:                                 <span class="ruby-identifier">title</span> = <span class="ruby-identifier">apply_span_transforms</span>( <span class="ruby-identifier">title</span>, <span class="ruby-identifier">rs</span> )
707: 
708:                                 <span class="ruby-identifier">level</span> = <span class="ruby-identifier">hdrchars</span>.<span class="ruby-identifier">length</span>
709:                                 <span class="ruby-value str">%{&lt;h%d&gt;%s&lt;/h%d&gt;\n\n}</span> <span class="ruby-operator">%</span> [ <span class="ruby-identifier">level</span>, <span class="ruby-identifier">title</span>, <span class="ruby-identifier">level</span> ]
710:                         }
711:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000012" class="method-detail">
        <a name="M000012"></a>

        <div class="method-heading">
          <a href="#M000012" class="method-signature">
          <span class="method-name">transform_hrules</span><span class="method-args">( str, rs )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Transform any Markdown-style horizontal rules in a copy of the specified
<tt>str</tt> and return it.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000012-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000012-source">
<pre>
     <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 454</span>
454:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">transform_hrules</span>( <span class="ruby-identifier">str</span>, <span class="ruby-identifier">rs</span> )
455:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot; Transforming horizontal rules&quot;</span>
456:                 <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>( <span class="ruby-regexp re">/^( ?[\-\*_] ?){3,}$/</span>, <span class="ruby-node">&quot;\n&lt;hr#{EmptyElementSuffix}\n&quot;</span> )
457:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000024" class="method-detail">
        <a name="M000024"></a>

        <div class="method-heading">
          <a href="#M000024" class="method-signature">
          <span class="method-name">transform_images</span><span class="method-args">( str, rs )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Turn image markup into image tags.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000024-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000024-source">
<pre>
      <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 968</span>
 968:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">transform_images</span>( <span class="ruby-identifier">str</span>, <span class="ruby-identifier">rs</span> )
 969:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot; Transforming images&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">str</span>
 970: 
 971:                 <span class="ruby-comment cmt"># Handle reference-style labeled images: ![alt text][id]</span>
 972:                 <span class="ruby-identifier">str</span>.
 973:                         <span class="ruby-identifier">gsub</span>( <span class="ruby-constant">ReferenceImageRegexp</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">match</span><span class="ruby-operator">|</span>
 974:                                 <span class="ruby-identifier">whole</span>, <span class="ruby-identifier">alt</span>, <span class="ruby-identifier">linkid</span> = <span class="ruby-identifier">$1</span>, <span class="ruby-identifier">$2</span>, <span class="ruby-identifier">$3</span>.<span class="ruby-identifier">downcase</span>
 975:                                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Matched %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">match</span>
 976:                                 <span class="ruby-identifier">res</span> = <span class="ruby-keyword kw">nil</span>
 977:                                 <span class="ruby-identifier">alt</span>.<span class="ruby-identifier">gsub!</span>( <span class="ruby-regexp re">/&quot;/</span>, <span class="ruby-value str">'&amp;quot;'</span> )
 978: 
 979:                                 <span class="ruby-comment cmt"># for shortcut links like ![this][].</span>
 980:                                 <span class="ruby-identifier">linkid</span> = <span class="ruby-identifier">alt</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">linkid</span>.<span class="ruby-identifier">empty?</span>
 981: 
 982:                                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rs</span>.<span class="ruby-identifier">urls</span>.<span class="ruby-identifier">key?</span>( <span class="ruby-identifier">linkid</span> )
 983:                                         <span class="ruby-identifier">url</span> = <span class="ruby-identifier">escape_md</span>( <span class="ruby-identifier">rs</span>.<span class="ruby-identifier">urls</span>[<span class="ruby-identifier">linkid</span>] )
 984:                                         <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Found url '%s' for linkid '%s' &quot;</span> <span class="ruby-operator">%</span> [ <span class="ruby-identifier">url</span>, <span class="ruby-identifier">linkid</span> ]
 985: 
 986:                                         <span class="ruby-comment cmt"># Build the tag</span>
 987:                                         <span class="ruby-identifier">result</span> = <span class="ruby-value str">%{&lt;img src=&quot;%s&quot; alt=&quot;%s&quot;}</span> <span class="ruby-operator">%</span> [ <span class="ruby-identifier">url</span>, <span class="ruby-identifier">alt</span> ]
 988:                                         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rs</span>.<span class="ruby-identifier">titles</span>.<span class="ruby-identifier">key?</span>( <span class="ruby-identifier">linkid</span> )
 989:                                                 <span class="ruby-identifier">result</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">%{ title=&quot;%s&quot;}</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">escape_md</span>( <span class="ruby-identifier">rs</span>.<span class="ruby-identifier">titles</span>[<span class="ruby-identifier">linkid</span>] )
 990:                                         <span class="ruby-keyword kw">end</span>
 991:                                         <span class="ruby-identifier">result</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">EmptyElementSuffix</span>
 992: 
 993:                                 <span class="ruby-keyword kw">else</span>
 994:                                         <span class="ruby-identifier">result</span> = <span class="ruby-identifier">whole</span>
 995:                                 <span class="ruby-keyword kw">end</span>
 996: 
 997:                                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Replacing %p with %p&quot;</span> <span class="ruby-operator">%</span> [ <span class="ruby-identifier">match</span>, <span class="ruby-identifier">result</span> ]
 998:                                 <span class="ruby-identifier">result</span>
 999:                         }.
1000: 
1001:                         <span class="ruby-comment cmt"># Inline image style</span>
1002:                         <span class="ruby-identifier">gsub</span>( <span class="ruby-constant">InlineImageRegexp</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">match</span><span class="ruby-operator">|</span>
1003:                                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Found inline image %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">match</span>
1004:                                 <span class="ruby-identifier">whole</span>, <span class="ruby-identifier">alt</span>, <span class="ruby-identifier">title</span> = <span class="ruby-identifier">$1</span>, <span class="ruby-identifier">$2</span>, <span class="ruby-identifier">$5</span>
1005:                                 <span class="ruby-identifier">url</span> = <span class="ruby-identifier">escape_md</span>( <span class="ruby-identifier">$3</span> )
1006:                                 <span class="ruby-identifier">alt</span>.<span class="ruby-identifier">gsub!</span>( <span class="ruby-regexp re">/&quot;/</span>, <span class="ruby-value str">'&amp;quot;'</span> )
1007: 
1008:                                 <span class="ruby-comment cmt"># Build the tag</span>
1009:                                 <span class="ruby-identifier">result</span> = <span class="ruby-value str">%{&lt;img src=&quot;%s&quot; alt=&quot;%s&quot;}</span> <span class="ruby-operator">%</span> [ <span class="ruby-identifier">url</span>, <span class="ruby-identifier">alt</span> ]
1010:                                 <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">title</span>.<span class="ruby-identifier">nil?</span>
1011:                                         <span class="ruby-identifier">title</span>.<span class="ruby-identifier">gsub!</span>( <span class="ruby-regexp re">/&quot;/</span>, <span class="ruby-value str">'&amp;quot;'</span> )
1012:                                         <span class="ruby-identifier">result</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">%{ title=&quot;%s&quot;}</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">escape_md</span>( <span class="ruby-identifier">title</span> )
1013:                                 <span class="ruby-keyword kw">end</span>
1014:                                 <span class="ruby-identifier">result</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">EmptyElementSuffix</span>
1015: 
1016:                                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Replacing %p with %p&quot;</span> <span class="ruby-operator">%</span> [ <span class="ruby-identifier">match</span>, <span class="ruby-identifier">result</span> ]
1017:                                 <span class="ruby-identifier">result</span>
1018:                         }
1019:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000022" class="method-detail">
        <a name="M000022"></a>

        <div class="method-heading">
          <a href="#M000022" class="method-signature">
          <span class="method-name">transform_italic_and_bold</span><span class="method-args">( str, rs )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Transform italic- and bold-encoded text in a copy of the specified
<tt>str</tt> and return it.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000022-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000022-source">
<pre>
     <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 873</span>
873:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">transform_italic_and_bold</span>( <span class="ruby-identifier">str</span>, <span class="ruby-identifier">rs</span> )
874:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot; Transforming italic and bold&quot;</span>
875: 
876:                 <span class="ruby-identifier">str</span>.
877:                         <span class="ruby-identifier">gsub</span>( <span class="ruby-constant">BoldRegexp</span>, <span class="ruby-value str">%{&lt;strong&gt;\\2&lt;/strong&gt;}</span> ).
878:                         <span class="ruby-identifier">gsub</span>( <span class="ruby-constant">ItalicRegexp</span>, <span class="ruby-value str">%{&lt;em&gt;\\2&lt;/em&gt;}</span> )
879:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000014" class="method-detail">
        <a name="M000014"></a>

        <div class="method-heading">
          <a href="#M000014" class="method-signature">
          <span class="method-name">transform_list_items</span><span class="method-args">( str, rs )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Transform list items in a copy of the given <tt>str</tt> and return it.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000014-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000014-source">
<pre>
     <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 515</span>
515:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">transform_list_items</span>( <span class="ruby-identifier">str</span>, <span class="ruby-identifier">rs</span> )
516:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot; Transforming list items&quot;</span>
517: 
518:                 <span class="ruby-comment cmt"># Trim trailing blank lines</span>
519:                 <span class="ruby-identifier">str</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">sub</span>( <span class="ruby-regexp re">/\n{2,}\z/</span>, <span class="ruby-value str">&quot;\n&quot;</span> )
520: 
521:                 <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>( <span class="ruby-constant">ListItemRegexp</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
522:                         <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;  Found item line %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">line</span>
523:                         <span class="ruby-identifier">leading_line</span>, <span class="ruby-identifier">item</span> = <span class="ruby-identifier">$1</span>, <span class="ruby-identifier">$4</span>
524: 
525:                         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">leading_line</span> <span class="ruby-keyword kw">or</span> <span class="ruby-regexp re">/\n{2,}/</span>.<span class="ruby-identifier">match</span>( <span class="ruby-identifier">item</span> )
526:                                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;   Found leading line or item has a blank&quot;</span>
527:                                 <span class="ruby-identifier">item</span> = <span class="ruby-identifier">apply_block_transforms</span>( <span class="ruby-identifier">outdent</span>(<span class="ruby-identifier">item</span>), <span class="ruby-identifier">rs</span> )
528:                         <span class="ruby-keyword kw">else</span>
529:                                 <span class="ruby-comment cmt"># Recursion for sub-lists</span>
530:                                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;   Recursing for sublist&quot;</span>
531:                                 <span class="ruby-identifier">item</span> = <span class="ruby-identifier">transform_lists</span>( <span class="ruby-identifier">outdent</span>(<span class="ruby-identifier">item</span>), <span class="ruby-identifier">rs</span> ).<span class="ruby-identifier">chomp</span>
532:                                 <span class="ruby-identifier">item</span> = <span class="ruby-identifier">apply_span_transforms</span>( <span class="ruby-identifier">item</span>, <span class="ruby-identifier">rs</span> )
533:                         <span class="ruby-keyword kw">end</span>
534: 
535:                         <span class="ruby-value str">%{&lt;li&gt;%s&lt;/li&gt;\n}</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">item</span>
536:                 }
537:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000013" class="method-detail">
        <a name="M000013"></a>

        <div class="method-heading">
          <a href="#M000013" class="method-signature">
          <span class="method-name">transform_lists</span><span class="method-args">( str, rs )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Transform Markdown-style lists in a copy of the specified <tt>str</tt> and
return it.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000013-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000013-source">
<pre>
     <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 486</span>
486:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">transform_lists</span>( <span class="ruby-identifier">str</span>, <span class="ruby-identifier">rs</span> )
487:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot; Transforming lists at %p&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">str</span>[<span class="ruby-value">0</span>,<span class="ruby-value">100</span>] <span class="ruby-operator">+</span> <span class="ruby-value str">'...'</span>)
488: 
489:                 <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>( <span class="ruby-constant">ListRegexp</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">list</span><span class="ruby-operator">|</span>
490:                         <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;  Found list %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">list</span>
491:                         <span class="ruby-identifier">bullet</span> = <span class="ruby-identifier">$1</span>
492:                         <span class="ruby-identifier">list_type</span> = (<span class="ruby-constant">ListMarkerUl</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">bullet</span>) <span class="ruby-operator">?</span> <span class="ruby-value str">&quot;ul&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-value str">&quot;ol&quot;</span>)
493:                         <span class="ruby-identifier">list</span>.<span class="ruby-identifier">gsub!</span>( <span class="ruby-regexp re">/\n{2,}/</span>, <span class="ruby-value str">&quot;\n\n\n&quot;</span> )
494: 
495:                         <span class="ruby-value str">%{&lt;%s&gt;\n%s&lt;/%s&gt;\n}</span> <span class="ruby-operator">%</span> [
496:                                 <span class="ruby-identifier">list_type</span>,
497:                                 <span class="ruby-identifier">transform_list_items</span>( <span class="ruby-identifier">list</span>, <span class="ruby-identifier">rs</span> ),
498:                                 <span class="ruby-identifier">list_type</span>,
499:                         ]
500:                 }
501:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000010" class="method-detail">
        <a name="M000010"></a>

        <div class="method-heading">
          <a href="#M000010" class="method-signature">
          <span class="method-name">unescape_special_chars</span><span class="method-args">( str )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Swap escaped special characters in a copy of the given <tt>str</tt> and
return it.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000010-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000010-source">
<pre>
     <span class="ruby-comment cmt"># File lib/bluecloth.rb, line 427</span>
427:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unescape_special_chars</span>( <span class="ruby-identifier">str</span> )
428:                 <span class="ruby-constant">EscapeTable</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">char</span>, <span class="ruby-identifier">hash</span><span class="ruby-operator">|</span>
429:                         <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Unescaping escaped %p with %p&quot;</span> <span class="ruby-operator">%</span> [ <span class="ruby-identifier">char</span>, <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">:md5re</span>] ]
430:                         <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub!</span>( <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">:md5re</span>], <span class="ruby-identifier">char</span> )
431:                 }
432: 
433:                 <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">str</span>
434:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>